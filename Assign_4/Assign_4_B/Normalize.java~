package Assign_4_B;

import Media.*; 
import static java.lang.Math.*; // max(a,b) to be used
//import static java.util.*; // to interate the picture one more time;



/** This class is a program to Normalize the intensity of brightness of a picture without extrapolate the 255 RGB value 
 
  * @author Heduin R. B. de Morais (Brock_ID 6967483, Campus_ID hr19ut, Lab#09) 
  * @version 1.0 (Nov. 2020)
  * new concepts: pixels and color channels
  * 
  * @param display to exibit the pictures
  * @param pic picture file to be shown
*/

public class Normalize {
  PictureDisplayer display;
  Picture pic;

  public Normalize() {
    //pic = new Picture();  // user select the picture
    pic = new Picture("../mission_beach_darker.jpg"); // DEBUG: pre-defined picture
    display = new PictureDisplayer(pic);
   
    display.waitForUser(); // Await users see the original, then press OK
    normIntensity(pic);  // non-destructive
    
    //saving before closing makes more sense
    pic.save(); // let's user to pick a name and folder
    //pic.save("saturated.jpg"); // DEBUG: pre-defined output name.jpg (destructive)
    
    display.close();
    
   };  // constructor Normalize
  
  /* This methose determines the largest channel value of the three channels (R, G and B) of the pixel p
   and returns that value.
   @param p pixel to be analized
   @return max of pixels values of {R, G, B} by using Math.max funcion of two values
   */
  private int maxChannel ( Pixel p ) {
    return max(p.getRed(),max(p.getGreen(),p.getBlue()));
  } // end maxChannel  
    
    
  /* This method normalizes the intensities of the channels of all pixels by finding the maximum
   * intensity of any channel, determining the factor necessary to raise this intensity to 255,
   * and then multiplying each channel value of every pixel by this value.
   * @param aPic picture to be saturated
   * @param p pixel to analized for max [R,G,B] = 255
   * @param maxLocal int returned by maxChannel()
   * @param maxRGB int max of all maxLocal
   * @param factor int that multiplies RGB to make values [0,255]
   */

  private void normIntensity ( Picture aPic ) {
    Pixel p;
    int maxRGB = 1;
    int maxLocal;
    int factor;
    
    // collect maximum value
    while(aPic.hasNext()){
      maxLocal = maxChannel(aPic.next());
      if ( maxLocal > maxRGB){        
        maxRGB = maxLocal;
        factor = (int)255/maxRGB; 
        p.setRed  (factor*p.getRed());
        p.setGreen(factor*p.getGreen());
        p.setBlue (factor*p.getBlue());
      
      }; 
    } // end while
      
    //find the factor
    

    // apply normalization 
    //aPic.iterator();  // reset the iterator since there is no next in aPic.hasNext()
    
    while(aPic.hasNext()){
      p = aPic.next();

    } // end while
    
    
    
    
  } // end normIntensity

  
// main function
public static void main ( String[] args ) { Normalize n = new Normalize(); };


}  // Normalize
    